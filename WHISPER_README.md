# Whisper 字幕生成器

使用 OpenAI Whisper 自動生成字幕，並燒錄到影片中的簡易工具。

## 🚀 快速開始

### 1. 安裝
雙擊 `install_whisper.bat` 自動安裝所有必要套件

### 2. 啟動
雙擊 `start_whisper_gui.bat` 啟動圖形介面

## 📋 使用步驟

### 模式 1: 生成字幕 + 燒錄影片
1. **選擇操作模式** - 選擇「生成字幕 + 燒錄影片」
2. **選擇輸入檔案**：
   - **影片檔案** - 支援 MP4, AVI, MOV 等格式
   - **音訊檔案** - 勾選「使用 WAV 音訊檔案」可獲得更高準確度
3. **設定輸出路徑** - 程式會自動建議路徑
4. **選擇 Whisper 模型**：
   - `tiny`: 最快，準確度較低
   - `base`: 快速，基本準確度
   - `small`: 平衡選擇
   - `medium`: **推薦**，準確度高
   - `large`: 最準確，但較慢
5. **選擇語言** - 日文選 `ja`，自動偵測選 `auto`
6. **調整字幕設定** - 字體大小和位置
7. **點擊按鈕**：
   - `生成字幕`: 只生成 SRT 檔案
   - `燒錄字幕`: 將現有字幕燒錄到影片
   - `一鍵完成`: 自動完成生成和燒錄

### 模式 2: 僅燒錄現有字幕 ⭐ 新功能
1. **選擇操作模式** - 選擇「僅燒錄現有字幕到影片」
2. **選擇影片檔案** - 要加上字幕的影片
3. **選擇字幕檔案** - 現有的 SRT 字幕檔案
4. **設定影片輸出路徑** - 燒錄後的影片存放位置
5. **調整字幕設定** - 字體大小和位置
6. **點擊「僅燒錄字幕」** - 直接燒錄，跳過 Whisper 生成步驟

## ⚙️ 功能特色

- ✅ **高準確度** - 使用 OpenAI Whisper 模型
- ✅ **支援多語言** - 日文、中文、英文等
- ✅ **雙輸入模式** - 支援影片檔案和音訊檔案
- ✅ **WAV 優化** - 使用 WAV 檔案獲得更高準確度
- ✅ **雙操作模式** - 生成字幕或僅燒錄現有字幕
- ✅ **圖形化介面** - 簡單易用
- ✅ **自動字幕燒錄** - 支援日文字體
- ✅ **中文路徑支援** - 自動處理包含中文字符的檔案路徑
- ✅ **編碼優化** - 解決 Windows 中文環境的編碼問題
- ✅ **即時日誌** - 顯示處理進度
- ✅ **模型管理** - 查看和管理 Whisper 模型
- ✅ **設定記憶** - 自動儲存偏好設定

## 📁 輸出檔案

- `影片名稱_whisper.srt` - 字幕檔案
- `影片名稱_with_subs.mp4` - 帶字幕的影片

## 🔧 進階設定

### 輸入檔案建議
- **WAV 音訊檔案**: 最高準確度，推薦用於重要內容
- **影片檔案**: 方便快速，適合一般使用
- **音訊品質**: 48kHz, 16-bit 或更高品質

### 模型選擇建議
- **短影片 (<5分鐘)**: medium 或 large
- **長影片 (>10分鐘)**: medium（平衡速度和準確度）
- **快速預覽**: small 或 base
- **最高準確度**: large（需要更多時間和記憶體）

### 語言設定
- `ja`: 日文（推薦用於日文歌曲）
- `auto`: 自動偵測（可能不夠準確）
- `en`: 英文
- `zh`: 中文

### Whisper 模型位置
- **預設位置**: `C:\Users\[用戶名]\.cache\whisper`
- **自訂位置**: 可透過程式或環境變數設定
- **模型格式**: 
  - 新版: `medium.pt`, `large.pt` 等
  - 舊版: `ggml-medium.bin`, `ggml-large.bin` 等
- **模型大小**: tiny(39MB) → base(74MB) → small(244MB) → medium(769MB) → large(1.5GB)
- **管理工具**: 
  - 程式內建模型管理功能
  - `move_whisper_models.bat` 一鍵移動工具

## ❗ 注意事項

1. **首次使用** - Whisper 會下載模型檔案，需要網路連線
2. **處理時間** - 根據影片長度和模型大小，可能需要幾分鐘到幾十分鐘
3. **記憶體需求** - large 模型需要較多記憶體
4. **檔案大小** - 燒錄字幕後的影片會稍微增大

## 🐛 常見問題

### Q: 找不到 Whisper 程式
A: 執行 `install_whisper.bat` 重新安裝

### Q: 字幕不準確
A: 嘗試使用更大的模型（medium → large）或使用 WAV 音訊檔案

### Q: 處理速度太慢
A: 使用較小的模型（medium → small）

### Q: 日文字幕顯示為問號
A: 程式會自動下載日文字體，請確保網路連線正常

### Q: 想要自訂模型存放位置
A: 三種方法：
1. 程式內勾選「自訂模型位置」
2. 執行 `move_whisper_models.bat` 一鍵移動
3. 手動設定環境變數 `WHISPER_CACHE_DIR`

### Q: 模型下載到一半中斷
A: 刪除不完整的模型檔案（.pt 或 .bin），重新執行程式會自動重新下載

### Q: 我的模型是 ggml-medium.bin 格式
A: 這是舊版 Whisper 模型格式，程式完全支援。新版是 medium.pt 格式，兩種都可以正常使用

### Q: 程式啟動失敗或出現路徑錯誤
A: **首先執行安裝檢查**：
1. 雙擊 `check_installation.bat` 進行完整檢查
2. 或執行 `python check_installation.py`
3. 根據檢查結果修正問題

**常見路徑問題**：
- 確保所有檔案都在同一個資料夾中
- 不要移動單個檔案，要移動整個專案資料夾
- 避免將專案放在需要管理員權限的位置

### Q: 出現編碼錯誤或亂碼
A: 程式已自動處理大部分編碼問題，如仍有問題：
1. 將檔案移至不含中文字符的路徑（如 `C:\temp\`）
2. 程式會自動偵測中文路徑並使用 Python API 模式
3. 確保 Windows 系統語言設定正確

### Q: Whisper 跳過某些檔案
A: 通常是編碼問題，程式會：
1. 自動切換到 Python API 模式
2. 繼續處理其他部分
3. 最終仍會生成完整字幕

## 🔧 故障排除

### 第一步：執行安裝檢查
```bash
# 雙擊執行或在命令列中執行
check_installation.bat
```

### 常見問題解決步驟：

1. **程式無法啟動**
   - 執行 `check_installation.bat` 檢查環境
   - 確保所有檔案都在同一資料夾
   - 重新執行 `install_whisper.bat`

2. **套件安裝失敗**
   - 以管理員身分執行命令提示字元
   - 執行 `pip install --upgrade pip`
   - 重新安裝：`pip install -r requirements.txt`

3. **字體或檔案路徑問題**
   - 程式會自動下載字體和創建配置檔案
   - 確保網路連線正常
   - 避免使用包含特殊字符的路徑

## 📞 技術支援

如有問題，請檢查：
1. **執行安裝檢查** - `check_installation.bat`
2. Python 是否正確安裝（建議 3.8+）
3. 所有套件是否安裝完成
4. 專案檔案是否完整
5. 硬碟空間是否足夠
6. 檔案路徑是否包含特殊字符