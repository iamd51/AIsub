# 音樂字幕生成指南

## 🎵 問題說明

在處理音樂檔案時，Whisper 有時會錯誤識別出與歌曲內容無關的文字，例如：
- 「作詞・作曲・編曲 初音ミク」
- 大量重複的製作資訊
- 純音樂符號「♪♪♪♪♪♪」
- 其他音樂元數據

## ✅ 解決方案

### 1. 預防措施（推薦）

#### 使用正確的設定
- **啟用「過濾重複」選項** ✅
- **啟用「智能優化」功能** ✅
- **選擇「音樂模式」** 🎵
- **使用較大的模型**（medium 或 large）

#### 最佳設定組合
```
模型: medium 或 large
語言: auto (自動偵測)
內容類型: music 或 song
音樂模式: ✅ 啟用
過濾重複: ✅ 啟用
智能優化: ✅ 啟用
品質等級: high
```

### 2. 事後清理（已生成問題字幕）

#### 方法一：使用清理工具
```bash
# 清理單個檔案
python clean_music_subtitles.py your_subtitle.srt

# 批量清理當前目錄所有SRT檔案
python clean_music_subtitles.py .

# 或使用批次檔案
clean_subtitles.bat
```

#### 方法二：使用增強版過濾器
```bash
# 測試過濾效果
python test_enhanced_filter.py

# 直接在Python中使用
from enhanced_music_filter import filter_srt_file
filter_srt_file("input.srt", "output_cleaned.srt")
```

## 🔧 技術原理

### 自動過濾機制
程式會自動檢測並過濾：

1. **音樂元數據關鍵詞**
   - 作詞、作曲、編曲
   - 初音ミク、ボーカロイド、VOCALOID
   - Composer、Lyricist、Arranger

2. **重複內容檢測**
   - 同一詞彙重複超過3次
   - 大量重複的字符

3. **符號內容過濾**
   - 純音樂符號（♪♫♬♩）
   - 無意義的標點符號組合

4. **長度和品質檢查**
   - 過短的無意義片段
   - 主要由符號組成的內容

### 過濾邏輯流程
```
原始文字 → 清理元數據 → 檢查重複 → 檢查符號比例 → 決定保留/過濾
```

## 📊 效果對比

### 過濾前
```srt
1
00:00:00,000 --> 00:00:09,279
作詞・作曲・編曲 初音ミク

2
00:00:30,880 --> 00:00:36,079
このコルワでは永遠が春と咲く
```

### 過濾後
```srt
1
00:00:30,880 --> 00:00:36,079
このコルワでは永遠が春と咲く
```

## 💡 使用建議

### 對於不同類型的音樂

#### 🎤 人聲歌曲
- 模型：medium 或 large
- 內容類型：song
- 音樂模式：啟用
- 靜音閾值：0.3-0.4

#### 🎼 純音樂
- 模型：small 或 medium
- 內容類型：music
- 音樂模式：啟用
- 靜音閾值：0.5-0.6

#### 🎙️ 播客/對話
- 模型：medium
- 內容類型：speech
- 音樂模式：關閉
- 靜音閾值：0.6

#### 🎵 混合內容
- 模型：large
- 內容類型：auto
- 音樂模式：啟用
- 智能優化：啟用

### 品質優化技巧

1. **音訊品質**
   - 使用 WAV 格式獲得最佳效果
   - 確保音訊清晰，無過多雜訊

2. **參數調整**
   - 溫度設為 0.0（更穩定的結果）
   - 啟用多次通過模式（更準確但較慢）

3. **後處理**
   - 使用字幕編輯器手動調整
   - 檢查時間軸是否準確

## 🚀 v2.2+ 新功能

### 自動整合過濾
- 新版本已自動整合增強版過濾器
- 無需額外設定，自動過濾無關內容
- 支援即時過濾和事後清理

### 智能檢測
- 自動識別音樂元數據
- 智能判斷重複內容
- 保留有意義的歌詞內容

### 批量處理
- 支援批量清理多個字幕檔案
- 自動備份原始檔案
- 詳細的處理報告

## ❓ 常見問題

### Q: 為什麼會出現「作詞・作曲・編曲 初音ミク」？
A: 這是 Whisper 錯誤識別音樂中的背景資訊或靜音片段。新版本已自動過濾。

### Q: 如何避免過度過濾？
A: 
- 使用較大的模型提高識別準確度
- 確保音訊品質良好
- 手動檢查過濾結果

### Q: 過濾後字幕變少了怎麼辦？
A: 
- 檢查原始音訊是否包含實際歌詞
- 調整靜音閾值設定
- 使用字幕編輯器手動添加遺漏內容

### Q: 可以自訂過濾規則嗎？
A: 可以修改 `enhanced_music_filter.py` 中的關鍵詞列表和過濾邏輯。

## 📝 總結

通過使用正確的設定和自動過濾機制，可以有效避免音樂字幕中出現無關內容。對於已生成的問題字幕，使用提供的清理工具可以快速修復。

記住：**預防勝於治療**，使用推薦設定可以從源頭避免問題！

---

**相關工具**：
- `clean_music_subtitles.py` - 字幕清理工具
- `enhanced_music_filter.py` - 增強版過濾器
- `test_enhanced_filter.py` - 過濾效果測試